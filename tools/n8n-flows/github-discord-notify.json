{
  "updatedAt": "2026-02-07T21:02:52.841Z",
  "createdAt": "2026-02-07T21:02:52.841Z",
  "id": "github-discord-notify",
  "name": "GitHub to Discord Notification",
  "description": null,
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "github-discord",
        "responseMode": "onReceived",
        "options": {
          "rawBody": true
        }
      },
      "id": "webhook-trigger",
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        250,
        300
      ],
      "webhookId": "github-discord-webhook"
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "language": "javaScript",
        "jsCode": "// HMAC Signature Validation for GitHub Webhooks\nconst crypto = require('crypto');\n\nconst items = $input.all();\nconst firstItem = items[0];\n\n// Get headers from webhook\nconst headers = firstItem.json.headers || {};\n\n// Check if this is a localhost request (bypass signature validation)\nconst host = headers['host'] || '';\nconst isLocalhost = host.includes('localhost') || host.includes('127.0.0.1');\n\nif (isLocalhost) {\n  console.log('Localhost request - skipping signature validation');\n  return items;\n}\n\n// Validate GitHub signature for non-localhost requests\nconst secret = $env.N8N_WEBHOOK_SECRET;\nconst signature = headers['x-hub-signature-256'];\n\nif (!signature) {\n  throw new Error('Missing X-Hub-Signature-256 header');\n}\n\nif (!secret) {\n  throw new Error('N8N_WEBHOOK_SECRET environment variable not set');\n}\n\n// Get raw body from binary data (webhook node stores raw body here when rawBody: true)\nconst rawBodyBuffer = firstItem.binary?.data?.data;\nif (!rawBodyBuffer) {\n  throw new Error('Raw body not available - ensure webhook node has rawBody: true');\n}\n\n// Convert base64 to string\nconst rawBody = Buffer.from(rawBodyBuffer, 'base64').toString('utf8');\n\n// Calculate HMAC signature on raw body (same as GitHub does)\nconst hmac = crypto\n  .createHmac('sha256', secret)\n  .update(rawBody)\n  .digest('hex');\n\nconst expectedSignature = `sha256=${hmac}`;\n\n// Verify signature matches\nif (signature !== expectedSignature) {\n  console.log('Signature mismatch:');\n  console.log('  Expected:', expectedSignature);\n  console.log('  Received:', signature);\n  throw new Error('Invalid GitHub signature');\n}\n\nconsole.log('âœ“ Signature validated successfully');\nreturn items;"
      },
      "id": "validate-signature",
      "name": "Validate Signature",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        450,
        300
      ]
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "language": "javaScript",
        "jsCode": "// Extract Event Data from GitHub Webhook\nconst items = $input.all();\nconst firstItem = items[0];\n\n// LOG: Full incoming data structure for debugging\nconsole.log('=== EXTRACT EVENT DATA - DEBUG ===');\nconsole.log('Full item structure:', JSON.stringify(firstItem, null, 2));\n\nconst payload = firstItem.json.body || {};\nconst headers = firstItem.json.headers || {};\nconst eventType = headers['x-github-event'] || 'unknown';\n\nconsole.log('Event type:', eventType);\nconsole.log('Headers:', JSON.stringify(headers, null, 2));\nconsole.log('Payload keys:', Object.keys(payload));\nconsole.log('Repository:', payload.repository?.full_name);\nconsole.log('Sender:', payload.sender?.login);\n\n// Build event data object\nconst eventData = {\n  timestamp: new Date().toISOString(),\n  event_type: eventType,\n  delivery_id: headers['x-github-delivery'] || 'unknown',\n  repository: payload.repository?.full_name || 'unknown',\n  sender: payload.sender?.login || 'unknown',\n  raw_payload: payload\n};\n\n// Extract event-specific data\nif (eventType === 'push') {\n  console.log('Processing push event');\n  eventData.branch = payload.ref?.replace('refs/heads/', '') || 'unknown';\n  eventData.commits = payload.commits?.length || 0;\n  eventData.head_commit = payload.head_commit || {};\n  eventData.compare_url = payload.compare || '';\n} else if (eventType === 'pull_request') {\n  console.log('Processing pull_request event');\n  eventData.action = payload.action || 'unknown';\n  eventData.pr_number = payload.pull_request?.number || 0;\n  eventData.pr_title = payload.pull_request?.title || '';\n  eventData.pr_url = payload.pull_request?.html_url || '';\n  eventData.pr_state = payload.pull_request?.state || '';\n  eventData.pr_merged = payload.pull_request?.merged || false;\n} else {\n  console.log('Unknown event type, using fallback');\n}\n\nconsole.log('Final eventData:', JSON.stringify(eventData, null, 2));\n\nreturn [{ json: eventData }];"
      },
      "id": "extract-event-data",
      "name": "Extract Event Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        650,
        300
      ]
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "language": "javaScript",
        "jsCode": "// Log Payload to File\nconst fs = require('fs');\nconst path = require('path');\n\nconst items = $input.all();\nconst data = items[0].json;\n\nconsole.log('=== LOG PAYLOAD - DEBUG ===');\nconsole.log('Logging data:', JSON.stringify(data, null, 2));\n\n// Use absolute path that matches docker volume mount\nconst logDir = '/home/node/.tmp/n8n-endpoint/github-discord';\nconst timestamp = new Date().toISOString().replace(/:/g, '-').split('.')[0];\nconst filename = `${timestamp}.json`;\nconst filepath = path.join(logDir, filename);\n\nconsole.log('Log directory:', logDir);\nconsole.log('Log filepath:', filepath);\n\ntry {\n  // Create directory recursively\n  if (!fs.existsSync(logDir)) {\n    console.log('Creating log directory...');\n    fs.mkdirSync(logDir, { recursive: true });\n  }\n  \n  // Write log file\n  fs.writeFileSync(filepath, JSON.stringify(data, null, 2));\n  console.log(`âœ“ Successfully logged payload to ${filepath}`);\n  \n  return [{\n    json: {\n      ...data,\n      log_file: filepath\n    }\n  }];\n} catch (error) {\n  // Log error but don't fail workflow (logging is non-critical)\n  console.error('âœ— Failed to write log file:', error.message);\n  console.error('Error details:', error);\n  return items;\n}"
      },
      "id": "log-payload",
      "name": "Log Payload",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        850,
        300
      ],
      "continueOnFail": true
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "language": "javaScript",
        "jsCode": "// Format Discord Message\nconst items = $input.all();\nconst data = items[0].json;\nconst eventType = data.event_type;\nconst payload = data.raw_payload || {};\n\nconsole.log('=== FORMAT DISCORD MESSAGE - DEBUG ===');\nconsole.log('Event type:', eventType);\nconsole.log('Repository:', data.repository);\nconsole.log('Sender:', data.sender);\nconsole.log('Payload structure:', Object.keys(payload));\n\nlet discordMessage = '';\n\nif (eventType === 'push') {\n  console.log('Formatting push event message');\n  const branch = data.branch || 'unknown';\n  const commits = payload.commits || [];\n  const sender = payload.sender || {};\n  const repo = payload.repository || {};\n  const compareUrl = data.compare_url || '';\n\n  discordMessage = `ðŸš€ **New Push to \\`${repo.full_name || 'unknown'}\\`**\\n\\n`;\n  discordMessage += `**Branch**: \\`${branch}\\`\\n`;\n  discordMessage += `**Pusher**: [${sender.login || 'unknown'}](${sender.html_url || '#'})\\n\\n`;\n\n  if (commits.length > 0) {\n    discordMessage += `**Commits** (${commits.length}):\\n`;\n    const displayCommits = commits.slice(0, 5);\n    \n    displayCommits.forEach(commit => {\n      const shortSha = (commit.id || 'unknown').substring(0, 7);\n      const message = (commit.message || 'No message').split('\\n')[0];\n      discordMessage += `â€¢ [\\`${shortSha}\\`](${commit.url || '#'}) - ${message}\\n`;\n    });\n    \n    if (commits.length > 5) {\n      discordMessage += `â€¢ ... and ${commits.length - 5} more commits\\n`;\n    }\n  }\n\n  if (compareUrl) {\n    discordMessage += `\\n[View Diff](${compareUrl})`;\n  }\n\n} else if (eventType === 'pull_request') {\n  const pr = payload.pull_request || {};\n  const action = data.action || 'unknown';\n  const repo = payload.repository || {};\n\n  let emoji = 'ðŸ“¬';\n  let actionText = 'Pull Request';\n  \n  if (action === 'closed' && pr.merged) {\n    emoji = 'âœ…';\n    actionText = 'Pull Request Merged';\n  } else if (action === 'closed') {\n    emoji = 'âŒ';\n    actionText = 'Pull Request Closed';\n  } else if (action === 'opened') {\n    emoji = 'ðŸ“¬';\n    actionText = 'Pull Request Opened';\n  } else {\n    emoji = 'ðŸ“¬';\n    actionText = `Pull Request ${action}`;\n  }\n\n  discordMessage = `${emoji} **${actionText} in \\`${repo.full_name || 'unknown'}\\`**\\n\\n`;\n  discordMessage += `**Title**: ${pr.title || 'No title'}\\n`;\n  discordMessage += `**Author**: [${pr.user?.login || 'unknown'}](${pr.user?.html_url || '#'})\\n`;\n  discordMessage += `**Branch**: \\`${pr.head?.ref || 'unknown'}\\` â†’ \\`${pr.base?.ref || 'unknown'}\\`\\n\\n`;\n\n  if (pr.body && pr.body.length > 0) {\n    const description = pr.body.substring(0, 200);\n    const ellipsis = pr.body.length > 200 ? '...' : '';\n    discordMessage += `**Description**:\\n${description}${ellipsis}\\n\\n`;\n  }\n\n  discordMessage += `[View Pull Request](${pr.html_url || '#'})`;\n  \n} else {\n  // Unknown event type\n  discordMessage = `ðŸ“« **GitHub Event: ${eventType}**\\n\\n`;\n  discordMessage += `**Repository**: ${data.repository || 'unknown'}\\n`;\n  discordMessage += `**Sender**: ${data.sender || 'unknown'}\\n`;\n}\n\nreturn [{\n  json: {\n    content: discordMessage,\n    event_data: data\n  }\n}];"
      },
      "id": "format-discord-message",
      "name": "Format Discord Message",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1050,
        300
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $env.DISCORD_WEBHOOKURL }}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "content",
              "value": "={{ $json.content }}"
            },
            {
              "name": "username",
              "value": "GitHub Bot"
            },
            {
              "name": "avatar_url",
              "value": "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"
            }
          ]
        },
        "options": {
          "timeout": 10000
        }
      },
      "id": "send-to-discord",
      "name": "Send to Discord",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1250,
        300
      ]
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "language": "javaScript",
        "jsCode": "// Format Success Response\nreturn [{\n  json: {\n    status: 'success',\n    message: 'Notification sent to Discord',\n    timestamp: new Date().toISOString()\n  }\n}];"
      },
      "id": "format-response",
      "name": "Format Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1450,
        300
      ]
    }
  ],
  "connections": {
    "Webhook Trigger": {
      "main": [
        [
          {
            "node": "Validate Signature",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validate Signature": {
      "main": [
        [
          {
            "node": "Extract Event Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Event Data": {
      "main": [
        [
          {
            "node": "Log Payload",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log Payload": {
      "main": [
        [
          {
            "node": "Format Discord Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Discord Message": {
      "main": [
        [
          {
            "node": "Send to Discord",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send to Discord": {
      "main": [
        [
          {
            "node": "Format Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "instanceId": "n8n-labs-lair-nntin-xyz"
  },
  "pinData": null,
  "versionId": "223b1934-706d-42ff-a09a-2326041e8344",
  "activeVersionId": "223b1934-706d-42ff-a09a-2326041e8344",
  "versionCounter": 8,
  "triggerCount": 1,
  "tags": [],
  "shared": [
    {
      "updatedAt": "2026-02-07T21:02:52.848Z",
      "createdAt": "2026-02-07T21:02:52.848Z",
      "role": "workflow:owner",
      "workflowId": "github-discord-notify",
      "projectId": "dSnNZv7zF1AxLQD6",
      "project": {
        "updatedAt": "2026-01-24T12:56:35.595Z",
        "createdAt": "2026-01-23T22:48:06.540Z",
        "id": "dSnNZv7zF1AxLQD6",
        "name": "Tin Nguyen <nguyen.ngoctindaniel@gmail.com>",
        "type": "personal",
        "icon": null,
        "description": null,
        "creatorId": "83ee6f71-c12c-418b-91c6-9096f2edc160"
      }
    }
  ]
}